<?xml version="1.0" encoding="UTF-8"?>
<!-- The name of the product -->
<?define Name = "Invinsense" ?>
<!-- The Description of the product -->
<?define Description = "Invinsense 3.0 Agent" ?>
<!-- The manufacturer, for setup package publisher and folder info -->
<?define Manufacturer = "Infopercept" ?>
<!-- The manufacturer, for AgentPackege and folder info -->
<?define AgentName = "IvsAgent" ?>
<!-- The manufacturer, for TrayPackage and folder info -->
<?define TrayName = "IvsTray" ?>
<!-- The manufacturer, for other tools and folder info -->
<?define ArtifactsName = "Artifacts" ?>
<!-- The version number of this setup package-->
<?define Version = "1.0.0" ?>
<!-- UpgradeCode must be unique and not changed once the first version of the program is installed. -->
<?define UpgradeCode = "{38ECE878-1645-4310-BD9A-B9CA57FE0DF0}" ?>
<!-- The name of the Cabinet -->
<?define CabName = "Invinsense.cab" ?>

<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">

	<!--Variable for Agent Service Directory-->
	<?define Agent_Service_TargetDir=$(var.IvsAgent.TargetDir)?>

	<!--Variable for Sample Application Directory-->
	<?define Tray_Application_TargetDir=$(var.IvsTray.TargetDir)?>

	<Product Id="*" Name="$(var.Name)" Manufacturer="$(var.Manufacturer)" UpgradeCode="$(var.UpgradeCode)" Version="$(var.Version)" Language="1033">

		<!--Setup or Installer with properties-->
		<Package InstallerVersion="200" Compressed="yes" InstallScope="perMachine" Manufacturer="$(var.Manufacturer)" Platform="x64"/>

		<!-- Allow upgrades and prevent downgrades -->
		<MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />

		<!--Embed Cabinet into single msi file-->
		<MediaTemplate EmbedCab="yes" />

		<!--Main Feature for this Setup which can be found in Fragment Tag with ComponentGroupRef Id-->
		<Feature Id="ProductFeature" Title="$(var.Name)" Level="1">
			<ComponentGroupRef Id="AgentComponents" />
			<ComponentGroupRef Id="TrayComponents" />
			<ComponentGroupRef Id="ToolComponents" />
		</Feature>
		
	</Product>

	<!--Fragment with details of installation directory-->
	<Fragment>
		<Directory Id="TARGETDIR" Name="SourceDir">
			<Directory Id="ProgramFiles64Folder">
				<Directory Id="ManufacturerFolder" Name="!(bind.property.Manufacturer)">
					<Directory Id="AGENTFOLDER" Name="$(var.AgentName)" />
					<Directory Id="TRAYFOLDER" Name="$(var.TrayName)" />
					<Directory Id="ARTIFACTSFOLDER" Name="$(var.ArtifactsName)" />
				</Directory>
			</Directory>
		</Directory>
	</Fragment>

	<Fragment>
		<ComponentGroup Id="AgentComponents" Directory="AGENTFOLDER">
			<Component Win64="yes">
				<File Source="$(var.IvsAgent.TargetPath)" />
			</Component>
		</ComponentGroup>
	</Fragment>

	<Fragment>
		<ComponentGroup Id="TrayComponents" Directory="TRAYFOLDER">
			<Component Win64="yes">
				<File Source="$(var.IvsTray.TargetPath)" />
			</Component>
		</ComponentGroup>
	</Fragment>

	<Fragment>
		<ComponentGroup Id="ToolComponents" Directory="ARTIFACTSFOLDER">
			<Component Win64="yes">
				<File Source="..\artifacts\LiteDB.Studio.exe" />
			</Component>
		</ComponentGroup>
	</Fragment>
	
</Wix>
